{"version":3,"sources":["webpack:///webpack/bootstrap b0d273454b1711eb447d","webpack:///./lib/p5-widget.ts","webpack:///./lib/defaults.ts"],"names":[],"mappings":"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","file":"dist/p5-widget.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap b0d273454b1711eb447d","import * as defaults from \"./defaults\";\r\n\r\nconst MY_FILENAME = 'p5-widget.js';\r\nconst IFRAME_FILENAME = 'p5-widget.html';\r\nconst IFRAME_STYLE = [\r\n  'width: 100%',\r\n  'background-color: #170c2b',\r\n  // 'border: 1px solid #67e480',\r\n  'border: none',\r\n  'box-sizing: border-box'\r\n];\r\nconst AVOID_MIXED_CONTENT_WARNINGS = true;\r\n\r\nlet myScriptEl = getMyScriptEl() as HTMLScriptElement;\r\nlet myBaseURL = getMyBaseURL(myScriptEl.src);\r\nlet autoload = !myScriptEl.hasAttribute('data-manual');\r\nlet nextId = 1;\r\n\r\nfunction getMyBaseURL(url: string) {\r\n  let baseURL = url.slice(0, -MY_FILENAME.length);\r\n\r\n  if (AVOID_MIXED_CONTENT_WARNINGS) {\r\n    if (window.location.protocol === 'http:' && /^https:/.test(baseURL)) {\r\n      // Our script was loaded over HTTPS, but the embedding page is\r\n      // using HTTP. This is likely to result in mixed content warnings\r\n      // if e.g. the widget's sketch wants to load resources relative to\r\n      // the embedding page's URL, so let's just embed the widget over\r\n      // HTTP instead of HTTPS.\r\n\r\n      baseURL = baseURL.replace('https:', 'http:');\r\n    }\r\n  }\r\n\r\n  return baseURL;\r\n}\r\n\r\nfunction getMyScriptEl() {\r\n  return (\r\n    document.currentScript ||\r\n    document.querySelectorAll(\"script[src$='\" + MY_FILENAME + \"']\")[0]\r\n  );\r\n}\r\n\r\nconst border = Math.max(window.innerHeight, window.innerWidth);\r\n// http://stackoverflow.com/a/7557433/2422398\r\nfunction isElementInViewport(el: HTMLElement) {\r\n  var rect = el.getBoundingClientRect();\r\n  return (\r\n    rect.bottom >= -border &&\r\n    rect.right >= -border &&\r\n    rect.top <= (window.innerHeight ||\r\n      document.documentElement.clientHeight) + border &&\r\n    rect.left <= (window.innerWidth ||\r\n      document.documentElement.clientWidth) + border\r\n  );\r\n}\r\n\r\nfunction getDataHeight(el: HTMLScriptElement) {\r\n  let height = parseInt(el.getAttribute('data-height'));\r\n\r\n  if (isNaN(height)) height = defaults.HEIGHT;\r\n\r\n  return height;\r\n}\r\n\r\nfunction absoluteURL(url: string) {\r\n  let a = document.createElement('a');\r\n  a.setAttribute('href', url);\r\n\r\n  return a.href;\r\n}\r\n\r\nfunction getSketch(url: string, cb: (sketch: string) => any) {\r\n  let error = (msg?: any) => {\r\n    let lines = ['// p5.js-widget failed to retrieve ' + url + '.'];\r\n\r\n    if (msg && typeof (msg) == 'string') {\r\n      lines.push('// ' + msg);\r\n    }\r\n\r\n    cb(lines.join('\\n'));\r\n  };\r\n  let req = new XMLHttpRequest();\r\n  req.open('GET', url);\r\n\r\n  req.onload = () => {\r\n    if (req.status == 200) {\r\n      cb(req.responseText);\r\n    } else {\r\n      error('Server returned HTTP ' + req.status + '.');\r\n    }\r\n  };\r\n\r\n  req.onerror = error;\r\n  req.send(null);\r\n}\r\n\r\nfunction replaceScriptWithWidget(el: HTMLScriptElement, callback?: (HTMLIFrameElement) => void) {\r\n  let iframe = document.createElement('iframe');\r\n  let height = getDataHeight(el);\r\n  let previewWidth = el.getAttribute('data-preview-width');\r\n  let baseSketchURL = absoluteURL(el.getAttribute('data-base-url'));\r\n  let p5version = el.getAttribute('data-p5-version');\r\n  let maxRunTime = parseInt(el.getAttribute('data-max-run-time'));\r\n  let autoplay = el.hasAttribute('data-autoplay');\r\n  let explicitSetup = el.hasAttribute('data-explicit-setup');\r\n  let lib = el.getAttribute('data-lib');\r\n\r\n  let url;\r\n  let qsArgs = [\r\n    'id=' + encodeURIComponent(el.getAttribute('data-id'))\r\n  ];\r\n  let style = IFRAME_STYLE.slice();\r\n\r\n  function makeWidget(sketch: string) {\r\n    qsArgs.push('sketch=' + encodeURIComponent(sketch));\r\n    // style.push('min-height: ' + height + 'px');\r\n    url = myBaseURL + IFRAME_FILENAME + '?' + qsArgs.join('&');\r\n    iframe.setAttribute('src', url);\r\n    iframe.setAttribute('style', style.join('; '));\r\n    iframe.addEventListener(\"load\", () => callback && callback(iframe));\r\n    if (el.parentNode)\r\n      el.parentNode.replaceChild(iframe, el);\r\n  }\r\n\r\n  // if (!isNaN(previewWidth) && previewWidth >= 0) {\r\n  qsArgs.push('previewWidth=' + previewWidth);\r\n  // }\r\n\r\n  if (!isNaN(maxRunTime) && maxRunTime >= 0) {\r\n    qsArgs.push('maxRunTime=' + maxRunTime);\r\n  }\r\n\r\n  if (baseSketchURL) {\r\n    qsArgs.push('baseSketchURL=' + encodeURIComponent(baseSketchURL));\r\n  }\r\n\r\n  if (p5version) {\r\n    qsArgs.push('p5version=' + encodeURIComponent(p5version));\r\n  }\r\n\r\n  if (autoplay) {\r\n    qsArgs.push('autoplay=on');\r\n  }\r\n\r\n  if (explicitSetup) {\r\n    qsArgs.push('explicitSetup=' + explicitSetup);\r\n  }\r\n\r\n  if (lib) {\r\n    qsArgs.push('lib=' + encodeURIComponent(lib));\r\n  }\r\n\r\n  if (el.src && el.textContent && el.textContent.trim()) {\r\n    return makeWidget([\r\n      '// Your widget includes both a \"src\" attribute and inline script',\r\n      '// content, which makes no sense. Please remove one of them.'\r\n    ].join('\\n'));\r\n  }\r\n\r\n  if (el.src) {\r\n    getSketch(el.src, makeWidget);\r\n  } else {\r\n    makeWidget(el.textContent);\r\n  }\r\n}\r\n\r\nfunction whenVisible(el: HTMLScriptElement,\r\n  cb: (el: HTMLScriptElement) => void) {\r\n  let CHECK_INTERVAL_MS = 1000;\r\n  let interval: number;\r\n\r\n  function maybeMakeVisible() {\r\n    if (!isElementInViewport(el)) return;\r\n\r\n    clearInterval(interval);\r\n    window.removeEventListener('scroll', maybeMakeVisible, false);\r\n    window.removeEventListener('resize', maybeMakeVisible, false);\r\n    cb(el);\r\n  }\r\n\r\n  // We want to check at a fixed interval as a fallback, to make\r\n  // sure that we detect when the element is visible even outside\r\n  // of the usual means (e.g., because the user did some\r\n  // sort of pinch/zoom gesture).\r\n  interval = setInterval(maybeMakeVisible, 1000);\r\n\r\n  window.addEventListener('scroll', maybeMakeVisible, false);\r\n  window.addEventListener('resize', maybeMakeVisible, false);\r\n  maybeMakeVisible();\r\n}\r\n\r\nfunction lazilyReplaceScriptWithWidget(el: HTMLScriptElement, callback?: (HTMLIFrameElement) => void) {\r\n  let height = getDataHeight(el);\r\n\r\n  el.style.display = 'block';\r\n  el.style.fontSize = '0';\r\n  el.style.width = '100%';\r\n  // el.style.minHeight = height + 'px';\r\n  el.style.background = '#f0f0f0';\r\n\r\n  if (!el.hasAttribute('data-id')) {\r\n    el.setAttribute('data-id', nextId.toString());\r\n    nextId++;\r\n  }\r\n\r\n  whenVisible(el, (el) => replaceScriptWithWidget(el, callback));\r\n}\r\n\r\nfunction lazilyReplaceAllScriptsWithWidget(callback?: (HTMLIFrameElement) => void) {\r\n  let scripts = document.querySelectorAll(\"script[type='text/p5']\");\r\n\r\n\r\n  [].slice.call(scripts).forEach((el: HTMLScriptElement) => {\r\n    lazilyReplaceScriptWithWidget(el, callback);\r\n  });\r\n}\r\n\r\nif (autoload) {\r\n  if (document.readyState === 'complete') {\r\n    lazilyReplaceAllScriptsWithWidget();\r\n  } else {\r\n    window.addEventListener(\r\n      'load',\r\n      () => lazilyReplaceAllScriptsWithWidget(),\r\n      false\r\n    );\r\n  }\r\n}\r\n\r\nwindow['p5Widget'] = {\r\n  baseURL: myBaseURL,\r\n  url: myBaseURL + MY_FILENAME,\r\n  replaceScript: lazilyReplaceScriptWithWidget,\r\n  replaceAll: lazilyReplaceAllScriptsWithWidget,\r\n  defaults: defaults\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./lib/p5-widget.ts","export const P5_VERSION = '0.4.23';\r\nexport const PREVIEW_WIDTH = 150;\r\nexport const HEIGHT = 300;\r\nexport const MAX_RUN_TIME = 1000;\r\nexport const EXPLICIT_SETUP = false;\r\n\n\n\n// WEBPACK FOOTER //\n// ./lib/defaults.ts"],"sourceRoot":""}